<!DOCTYPE html>
<html lang="en">
<head>
  <meta charSet="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SecondBrain</title>
  <meta name="description" content="Personal knowledge and projects dashboard"/>
  <link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/>

  <!-- 🧩 On garde UNIQUEMENT le CSS généré par Next -->
  <link rel="stylesheet" href="/_next/static/css/c32b38c52944d119.css" data-precedence="next"/>
  <!-- ❌ On supprime tous les <script> Next (webpack, app/page, polyfills, etc.) -->
  <style>
    /* petits garde-fous visuels si jamais certaines variables CSS n'existent pas */
    :root {
      --bg: #0b0b10;
      --card-bg: #11121a;
      --border: rgba(255,255,255,0.12);
      --border-strong: rgba(255,255,255,0.2);
      --muted-90: rgba(255,255,255,0.9);
    }
    body{min-height:100vh}
  </style>
</head>

<body class="min-h-screen bg-[var(--bg)] text-white">
  <div class="flex gap-6 min-h-screen">
    <aside aria-label="Primary" class="w-[260px] min-w-[260px] bg-[var(--bg)] border-r border-[var(--border)] p-6 hidden lg:flex lg:flex-col">
      <div class="flex items-center gap-3 text-xl font-black tracking-tight mb-6">
        <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-white/10">🧠</span>
        <span>SecondBrain</span>
      </div>

      <div class="relative mb-4">
        <label for="search" class="sr-only">Search your SecondBrain</label>
        <input id="search" placeholder="Search your SecondBrain" class="w-full rounded-xl bg-white/5 border border-[var(--border)] px-4 py-2 text-sm placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-indigo-500/40"/>
      </div>

      <nav class="space-y-1 text-sm">
        <a class="flex items-center gap-3 rounded-lg px-3 py-2 text-white/80 hover:bg-white/10 hover:text-white" href="/"><span class="inline-block w-5">🏠</span>Dashboard</a>
        <a class="flex items-center gap-3 rounded-lg px-3 py-2 text-white/80 hover:bg-white/10 hover:text-white" href="/projects/"><span class="inline-block w-5">📂</span>Projects</a>
        <a class="flex items-center gap-3 rounded-lg px-3 py-2 text-white/80 hover:bg-white/10 hover:text-white" href="/areas/"><span class="inline-block w-5">✅</span>Areas</a>
        <a class="flex items-center gap-3 rounded-lg px-3 py-2 text-white/80 hover:bg-white/10 hover:text-white" href="/resources/"><span class="inline-block w-5">📚</span>Resources</a>
        <a class="flex items-center gap-3 rounded-lg px-3 py-2 text-white/80 hover:bg-white/10 hover:text-white" href="/archives/"><span class="inline-block w-5">🗄️</span>Archives</a>
      </nav>

      <div class="mt-8">
        <h4 class="text-white/60 text-xs uppercase tracking-wider mb-3">Current projects</h4>
        <ul class="space-y-2 text-sm">
          <li class="flex items-start gap-2"><span class="mt-0.5">📁</span><a class="hover:underline decoration-white/30 leading-snug" href="#">Design the UX of the contact information page</a></li>
          <li class="flex items-start gap-2"><span class="mt-0.5">📁</span><a class="hover:underline decoration-white/30 leading-snug" href="#">Organise Lauren's surprise birthday party</a></li>
          <li class="flex items-start gap-2"><span class="mt-0.5">📁</span><a class="hover:underline decoration-white/30 leading-snug" href="#">Renovate the garage</a></li>
          <li class="flex items-start gap-2"><span class="mt-0.5">📁</span><a class="hover:underline decoration-white/30 leading-snug" href="#">Organise your cloud storage</a></li>
        </ul>
      </div>

      <div class="mt-auto pt-6 space-y-6">
        <div class="flex items-center gap-3">
          <div class="h-9 w-9 rounded-full bg-white/10 grid place-items-center">👤</div>
          <div class="leading-tight">
            <div class="text-sm">User Name</div>
            <div class="text-xs text-white/70">username@example.com</div>
          </div>
        </div>
        <div class="space-y-2 text-sm">
          <button class="w-full text-left rounded-lg bg-white/5 border border-[var(--border)] px-3 py-2 hover:bg-white/10">Preferences</button>
          <button class="w-full text-left rounded-lg bg-white/5 border border-[var(--border)] px-3 py-2 hover:bg-white/10">Log out</button>
        </div>
      </div>
    </aside>

    <main class="flex-1 pr-6 pb-8 pt-6 max-w-[1150px] mx-auto w-full">
      <div class="space-y-6">
        <div class="grid grid-cols-1 xl:grid-cols-[1fr_340px] gap-6">
          <section class="rounded-2xl bg-[var(--card-bg)] border border-[var(--border)] p-5">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold tracking-tight">Overview</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="flex md:col-span-1">
                <div class="relative h-28 w-28 rounded-full bg-[var(--bg)] border-2 border-[var(--border-strong)] grid place-items-center shadow-inner">
                  <div class="text-center">
                    <div class="text-3xl font-black">9.0</div>
                    <div class="text-xs text-white/70">/10</div>
                  </div>
                  <span class="absolute -inset-1 rounded-full border border-white/5 pointer-events-none"></span>
                </div>
                <div class="ml-4">
                  <div class="text-sm text-white/70">Weekly focus score</div>
                  <p class="text-xs text-white/60 mt-1 max-w-[14ch]">How consistently you touched notes &amp; projects</p>
                </div>
              </div>

              <div class="md:col-span-2 grid grid-cols-3 gap-3">
                <div class="rounded-xl bg-[var(--bg)] border border-[var(--border)] p-4 flex items-center gap-3">
                  <div class="h-8 w-8 rounded-lg bg-white/10 grid place-items-center text-sm">8</div>
                  <div class="text-sm text-white/80">Projects</div>
                </div>
                <div class="rounded-xl bg-[var(--bg)] border border-[var(--border)] p-4 flex items-center gap-3">
                  <div class="h-8 w-8 rounded-lg bg-white/10 grid place-items-center text-sm">5</div>
                  <div class="text-sm text-white/80">Areas</div>
                </div>
                <div class="rounded-xl bg-[var(--bg)] border border-[var(--border)] p-4 flex items-center gap-3">
                  <div class="h-8 w-8 rounded-lg bg-white/10 grid place-items-center text-sm">67</div>
                  <div class="text-sm text-white/80">Resources</div>
                </div>
                <div class="rounded-xl bg-[var(--bg)] border border-[var(--border)] p-4 flex items-center gap-3">
                  <div class="h-8 w-8 rounded-lg bg-white/10 grid place-items-center text-sm">13</div>
                  <div class="text-sm text-white/80">Archives</div>
                </div>
              </div>
            </div>
          </section>

          <section class="rounded-2xl bg-[var(--card-bg)] border border-[var(--border)] p-5">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold tracking-tight">Recent progress</h2>
            </div>
            <ul class="space-y-3">
              <li class="flex items-center justify-between rounded-xl bg-[var(--bg)] border border-[var(--border)] p-3">
                <div class="flex items-center gap-3">
                  <span class="h-9 w-9 rounded-lg bg-white/10 grid place-items-center text-base">💡</span>
                  <div>
                    <div class="font-medium">Research</div>
                    <div class="text-xs text-white/70">Wrapped up a project milestone.</div>
                  </div>
                </div>
                <div class="flex gap-2">
                  <button class="rounded-xl border transition-colors disabled:opacity-60 disabled:cursor-not-allowed text-xs px-3 py-1.5 bg-transparent border-[var(--border)] hover:bg-white/10">View</button>
                </div>
              </li>

              <li class="flex items-center justify-between rounded-xl bg-[var(--bg)] border border-[var(--border)] p-3">
                <div class="flex items-center gap-3">
                  <span class="h-9 w-9 rounded-lg bg-white/10 grid place-items-center text-base">✅</span>
                  <div>
                    <div class="font-medium">Development</div>
                    <div class="text-xs text-white/70">Refreshed docs and resources.</div>
                  </div>
                </div>
                <div class="flex gap-2">
                  <button class="rounded-xl border transition-colors disabled:opacity-60 disabled:cursor-not-allowed text-xs px-3 py-1.5 bg-transparent border-[var(--border)] hover:bg-white/10">View</button>
                </div>
              </li>

              <li class="flex items-center justify-between rounded-xl bg-[var(--bg)] border border-[var(--border)] p-3">
                <div class="flex items-center gap-3">
                  <span class="h-9 w-9 rounded-lg bg-white/10 grid place-items-center text-base">📦</span>
                  <div>
                    <div class="font-medium">Knowledge</div>
                    <div class="text-xs text-white/70">Expanded your knowledge base.</div>
                  </div>
                </div>
                <div class="flex gap-2">
                  <button class="rounded-xl border transition-colors disabled:opacity-60 disabled:cursor-not-allowed text-xs px-3 py-1.5 bg-transparent border-[var(--border)] hover:bg-white/10">View</button>
                  <button class="rounded-xl border transition-colors disabled:opacity-60 disabled:cursor-not-allowed text-xs px-3 py-1.5 bg-[var(--card-bg)] border-[var(--border-strong)] hover:bg-white/10">Explore</button>
                </div>
              </li>
            </ul>
          </section>
        </div>

        <!-- === AI assistant === -->
        <section class="rounded-2xl bg-[var(--card-bg)] border border-[var(--border)]">
          <div class="p-5">
            <div class="text-lg font-semibold">AI assistant</div>
            <p class="text-xl md:text-2xl font-extrabold tracking-tight mt-3 leading-snug text-[var(--muted-90)]">
              Ask the assistant anything.
            </p>
          </div>
          <div class="border-t border-[var(--border)] p-4">
            <div class="relative">
              <label for="aiq" class="sr-only">Ask anything…</label>
              <input id="aiq" placeholder="Ask anything… (press Enter to send)"
                     class="w-full rounded-xl bg-[var(--bg)] border border-[var(--border)] px-4 py-3 text-sm placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-indigo-500/40"/>
              <button aria-label="More actions"
                      class="absolute right-2 top-1/2 -translate-y-1/2 rounded-lg border border-[var(--border)] bg-[var(--card-bg)] px-2 py-1 text-sm hover:bg-white/10"
                      type="button">⋯</button>
            </div>
            <div id="ai-log" class="mt-4 rounded-xl bg-[var(--bg)] border border-[var(--border)] p-3 text-sm max-h-72 overflow-y-auto">
              <div class="text-white/60">Say hi to the assistant 👋</div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    (function () {
      const input = document.getElementById('aiq');
      const log = document.getElementById('ai-log');
      if (!input || !log) return;

      function addLine(text, who) {
        const row = document.createElement('div');
        row.className = 'my-1';
        row.innerHTML = who === 'user'
          ? '<div class="text-white"><strong>Me:</strong> ' + text + '</div>'
          : '<div class="text-white/90"><strong>Agent:</strong> ' + text + '</div>';
        log.appendChild(row);
        log.scrollTop = log.scrollHeight;
      }

      function getUserId() {
        let uid = localStorage.getItem('user_id');
        if (!uid) { uid = 'web-' + Math.random().toString(36).slice(2, 10); localStorage.setItem('user_id', uid); }
        return uid;
      }
      function getConvId() { return localStorage.getItem('conversation_id') || null; }
      function setConvId(id) { if (id) localStorage.setItem('conversation_id', id); }

      async function sendMessage(text) {
        addLine(text, 'user');
        try {
          const res = await fetch('/api/agent/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              user_id: getUserId(),
              conversation_id: getConvId(),
              message: text
            })
          });
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const data = await res.json();
          if (data.conversation_id) setConvId(data.conversation_id);
          addLine(data.reply ?? '[empty reply]', 'bot');
        } catch (err) {
          addLine('Error: ' + (err.message || String(err)), 'bot');
        }
      }

      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          const text = input.value.trim();
          if (!text) return;
          input.value = '';
          sendMessage(text);
        }
      });
    })();
  </script>
</body>
</html>
